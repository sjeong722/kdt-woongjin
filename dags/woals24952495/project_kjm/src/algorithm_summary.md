# 지하철 실시간 데이터 가공 알고리즘 정리

본 프로젝트는 1분 단위의 실시간 위치 스냅샷을 시간표와 비교 가능한 '이벤트' 형태로 변환합니다.

## 1. 데이터 전환 전략 (4단계 -> 2단계)
실시간 API에서 제공하는 4가지 상태값을 시간표의 도착/출발 시각으로 압축합니다.

*   **입력(Raw)**: [진입(0), 도착(1), 출발(2), 전역출발(3)]
*   **출력(Event)**: [도착_시각(Arrival), 출발_시각(Departure)]

## 2. 핵심 알고리즘: 상태 변화 감지 (State Transition)
동일한 열차(`train_code`)가 동일한 역(`station_name`)에 대해 여러 번 기록될 때 아래 규칙에 따라 시간을 확정합니다.

1.  **도착 시각 (actual_arrival) 결정**:
    *   해당 역에 대해 `진입(0)` 또는 `도착(1)` 상태로 찍힌 여러 데이터 중 **가장 빠른(MIN)** 타임스탬프를 기차의 도착 시점으로 간주합니다.
    *   *효과*: "진입"이 먼저 찍히면 진입 시간을, "진입" 없이 "도착"부터 찍히면 도착 시간을 자동으로 선택합니다.

2.  **출발 시각 (actual_departure) 결정**:
    *   해당 역에 대해 `출발(2)` 상태로 찍힌 데이터 중 **가장 빠른(MIN)** 타임스탬프를 기차의 출발 시점으로 간주합니다.

3.  **데이터 정제 (Cleaning)**:
    *   `전역출발(3)` 상태는 해당 역의 분석에 혼선을 줄 수 있으므로 분석 대상에서 제외합니다.
    *   열차 번호에서 영문자(K, S 등)를 제거하고 숫자만 남겨 시간표 데이터와의 조인(Join) 성공률을 높였습니다.

## 3. 예외 상황 처리
*   **데이터 유실**: 도착(1) 없이 바로 출발(2)만 찍힌 경우, 도착 시간은 `null`로 남으며 출발 시간만 기록됩니다. (지연 시간 분석 시 출발 시간을 기준으로 대체 분석 가능)
*   **중복 수집**: 점검 등의 이유로 같은 열차 번호가 여러 번 수집되어도 `GROUP BY`와 `MIN` 함수를 통해 하나의 논리적 이벤트로 병합됩니다.
